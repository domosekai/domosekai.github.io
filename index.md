## Introduction

Trip Reader is an NFC card reader app that supports public transit cards issued across China. 
Compared with other similar products, Trip Reader focuses on the display of rail transit line station names and bus routes. It is mainly intended for ordinary users, while also taking into account the needs of professional users and card lovers.

读卡识途(Trip Reader)是一款NFC读卡APP，提供中国各地公交卡查询。与其他同类产品相比，读卡识途侧重于轨道交通线路站名和公交线路的显示，主要面向普通用户，同时兼顾专业人士和卡类爱好者的需求。

目前已在Apple、Google Play上架，中国大陆用户也可从[华为应用市场](https://appstore.huawei.com/app/C101780187)和[小米应用商店](http://app.mi.com/details?id=com.domosekai.cardreader)下载。
其他品牌手机用户可使用电脑访问应用市场下载安装包。

<a href='https://apps.apple.com/cn/app/%E8%AF%BB%E5%8D%A1%E8%AF%86%E9%80%94-nfc%E8%AF%BB%E5%8D%A1%E5%99%A8/id1488582968?mt=8'><img alt='Download on the App Store' width="140" hspace="60" src='Download_on_the_App_Store_Badge_US-UK_RGB_blk_092917.svg'/></a>

<a href='https://play.google.com/store/apps/details?id=com.domosekai.cardreader'><img alt='Get it on Google Play' width="160" src='google-play-badge.png' hspace="50"/></a>

## Database

Some of the data used in Trip Reader is published at the address below to benefit NFC development activities.

读卡识途使用的部分数据已在以下地址公开，以鼓励NFC相关的开发活动。

https://github.com/domosekai/tripreader-data

## Acknowledgment

感谢向本项目提供大量数据的热心用户（敬称略）：

Chenyue Feng, 涛涨流, RisingTank, Lyu Han, 一月东城殇, Panda, Rayista, 虹羽, 龙腾四海, 马丁, 千葉, 晴转の多云, 随便, 笑脸, 肖新宇, 眼泪, 羊局驼段, 恒沐, 雨鸽, 黑森林里会迷路, 走马行酒醴, 同宇工作室, 夜空守望者, 北陽, BH2SEB, 机智轩の微視角, 兰love新一, HXD3CA7501, 龙牙, 暖暖小柿子, 艾拉, 化身大禹治水的染色体, 杨诚, 城市通卡, WarmMarine, ycn, Robert Lyu, Guy Zhang, 无聊, 魔王, Neptune, 細貓Lil Cat, 黄柏之, line17, 小鱼吐泡泡

同时感谢所有给予我反馈、建议、协助补充卡片名称的用户（名单太长恕从略）。

## 各地交联卡写错城市和交通工具汇总 T-Union known issues by region

- 辽宁省

   沈阳公交：卡机（雄帝）将交易地错写为发卡地
   
   大连公交：卡机（大连现代高技术）将交易地错写为发卡地
   
- 吉林省

   长春地铁：不写1E文件，无法识别交易地和交易类型

   长春公交：部分卡机（雄帝）将交易地错写为吉林市

- 黑龙江省

   哈尔滨公交：部分卡机将交易地错写为枣庄市

- 天津市

   滨海公交：将交易地错写为发卡地
   
- 河北省

   石家庄地铁：在1E文件写入错误时间（2022-2023年）和金额，但18文件正确，导致显示混乱，无法修复

   邢台公交：将交易地错写为发卡地
   
   唐山公交：对本地卡不写1E文件，无法识别交易地和交易类型
   
   廊坊公交：交易地代码写0650，收单机构写成发卡机构
   
- 山西省

   太原公交：对本地卡不写1E文件，无法识别交易地和交易类型
   
   吕梁公交：卡机（雄帝）错写为厦门
   
   晋中、临汾公交：卡机（恒宇）将交易地写上次交易地
   
   朔州公交：卡机（雄帝）将交易地错写为发卡地
   
   阳泉公交：卡机（公用）在城市代码写江苏省，收单机构写晋城市

- 山东省

   济南地铁：不写1E文件，无法识别交易地和交易类型
   
   枣庄、菏泽公交：卡机（恒宇）将交易地写上次交易地
   
   威海公交：部分卡机（雄帝）错写为揭阳
   
   青岛公交：部分卡机不写1E文件，无法识别交易地和交易类型
   
   潍坊公交：卡机在1E文件写入错误城市代码（7788），无法识别正确的城市
   
- 陕西省

   西安公交：部分卡机（德卡）将交易地错写为发卡地
   
   西安地铁：对本地卡不写1E文件，无法识别交易地和交易类型

   安康公交：卡机（雄帝）错写为新疆
   
   杨凌公交：部分卡机不写1E文件，无法识别交易地和交易类型

- 河南省

   郑州地铁：部分闸机不写1E文件，无法识别交易地和交易类型
   
   开封公交：卡机（雄帝）错写为发卡地
   
   许昌公交：卡机（雄帝）错写为海口（与淮北问题相同，app暂不显示城市名）
   
   周口公交：卡机（雄帝）错写为发卡地

- 安徽省

   合肥地铁：将1E记录时间错写为30年前（app已尽量修正）

   合肥公交：部分卡机不写1E文件，无法识别交易地和交易类型
   
   淮北公交：卡机（雄帝）错写为海口（与许昌问题相同，app暂不显示城市名）
   
   淮南公交：卡机（雄帝）错写为肇庆
   
   芜湖公交：部分卡机不写1E文件，无法识别交易地和交易类型
   
- 江苏省

   连云港、南通、江阴、张家港、溧阳、宝应县公交：部分卡机不写1E文件，无法识别交易地和交易类型
      
   淮安公交、无锡出租车：将交易地错写为发卡地
   
   太仓市：部分卡机（雄帝）将交易地错写为包头
   
   靖江市：卡机（恒宇）将交易地写上次交易地

- 浙江省

   杭州地铁和公交、宁波3号线、宁波2号线二期段：不写1E文件，无法识别交易地和交易类型
   
   宁波、湖州公交：部分卡机（亿达）错写为襄阳
      
- 江西省

   南昌地铁：1号线闸机不写1E文件，无法识别交易地和交易类型
   
   九江公交：卡机（三联）将交易地错写为发卡地
   
- 福建省

   福州地铁：1号线不写1E文件，无法识别交易地和交易类型
   
   福州公交：部分卡机（天津通卡）对本地卡不写1E文件，无法识别交易地和交易类型
   
- 四川省

   成都公交：部分卡机（德卡）将交易地写为发卡地，将收单机构写为天津
   
   广元公交：将交易地错写为发卡地
   
   宜宾公交：三联卡机将交易地错写为0755，收单城市错写为延安市
   
   广安公交：雄帝卡机将收单机构写为发卡机构，城市代码正确
   
- 重庆市

   公交：部分卡机（雄帝）在交易地代码写0000，无法识别城市
   
- 湖南省

   长沙公交：部分卡机（雄帝）错写为海口
   
   衡阳公交：卡机（三联）错写为铜仁
   
   永州、株洲公交、郴州郴汽集团：不写1E文件，无法识别交易地和交易类型
   
   张家界公交：错写为发卡地

- 广东省

   佛山、江门公交：部分卡机（三联）将交易地错写发卡地
   
   惠州公交：卡机（雄帝）错写韶关

   深圳地铁：部分闸机不写进站记录
   
   中山公交：部分卡机不写记录（走电子现金）
   
   湛江公交：部分卡机（雄帝）错写肇庆
   
- 广西自治区

   南宁地铁：3号线闸机不写1E文件，无法识别交易地和交易类型，1、2号线不写站点编号
   
   南宁公交：部分卡机不写1E文件，无法识别交易地和交易类型
   
   桂林公交：卡机（三联）错写为黔西南

- 甘肃省

   兰州公交：部分卡机（雄帝）错写为新疆

   定西公交：不写城市和收单机构代码，无法识别交易地
   
   白银公交：错写为发卡地
   
- 新疆自治区

   乌鲁木齐公交：部分卡机（雄帝）错写肇庆、三亚

## FAQ (Chinese only)

- **为什么开发这个APP？**

   以前在日本旅行时使用过日本读卡APP，对其细致程度深感震惊。不仅轨道交通和公交线路所有站点名字，连闸机在车站的哪个出口第几台都能显示。
   但当时囿于能力和精力，并未起心动念开发。
   
   直到2019年9月，iOS 13开放了NFC读卡功能，而我恰好有一段空闲时间，遂从10月起投入读卡器的开发。
   
- **作者是业内人士吗？**

   不是，准确来说我连公交卡爱好者都算不上。也正因为此，我主要从普通使用者的角度思考，APP需要什么样的功能。
   过于专业的功能已经由其他专业APP提供，我把精力主要放在实用信息的显示上。
   
- **APP界面过于简陋？**

   确实。我并非计算机专业出身，虽然爱好编程，但除了Excel小插件外没有编过什么像样的程序。移动端开发更是全新的领域。
   因此，我选择在不影响功能的前提下，最大程度简化界面，这样才可能在较短的时间内完成第一版。
   
- **为什么只有几个城市可显示站名？**

   如上所述，我并非业内人士，缺乏相关的资源。目前支持的每一个城市的数据都是我实地调查得到的。
   为了让APP尽早推出第一版，我只能先覆盖一线城市，兼顾轨道里程较多的其他主要城市。后续会再陆续支持其他城市。
   
- **目前有哪些已知的问题？**

   硬件方面，部分用户反映iPhone 7系列读卡经常失败，上海交联首发卡也存在比较严重的兼容性问题，南京交联卡（金陵通）则有部分卡种无法被iPhone读取。
   
   软件上的bug我在不断收集和改善中，但有些是我比较难以解决的，主要包括：
   
   - 城市名显示错误
   
      刷卡机写错城市代码的情况并不少见，即便写对了，代码本身有多个版本。如住建部时代，标准的城市代码是邮编前四位，
      但也有城市使用电话区号，甚至身份证号前四位作为代码。到了交通部时代，有部分城市在写入交通联合卡片时仍然沿用
      原代码，造成混乱。这类问题只能发现一处改善一处，因此还请发现后通过邮件或其他途径告知我。
   
   - 交易记录不完整
   
      如有入闸无出闸，有实际消费无记录等，这是各地刷卡机不完善造成的缺失。在APP层面无法解决。

- **发现bug后如何报告？**

   请写邮件到support@domosekai.com，附上错误的详细内容，正确的信息，并最好提供“专家信息”的截图。“专家信息”是1.3版的新功能，在设置中打开。

- **什么时候能支持XX市？**

   原则上我会按照轨道交通里程数顺序继续开拓新的城市。但考虑到疫情，目前无法确定时间表。
   
   如果您非常渴望所在城市获得支持，可以参照以下方法自主调查，我会远程提供必要的协助。
   
   另外，非常欢迎有资源的人士提供资料，帮助本项目壮大。
   
- **一般调查法介绍**

   - 交通联合卡
   
      相较而言，交联卡调查较为简单，因为交易通常会写入1E记录，该记录已对地铁还是公交进行了大致的区分。
      请打开APP的专家信息，注意交易类型、辅助类型和线路和站点的代码。一般而言，轨道交通的代码是线路号+站点号，但是各地编号规则不同。
      您可以使用控制变量法，如同一条线路，A站进，B站出，观察代码哪里发生了变化（与站点有关），哪里不变（与线路有关）。
      
      掌握了大概的规律以后，您需要坐遍所有线路，保证数据准确。通常来说一条线上会按某种顺序编号，不可能也没有必要出入每一个站，
      但需要确定首末站编号。另外如有以下情况的请特别注意，必要时要多跑几个站：
      
      - 不连号
      
      如您测得A站编号10，B站编号20，但A和B站中并不是9个站。常见的原因：中间有预留站或新建站，或者这条线分几期建设，每一期编号不同。
         
      - 换乘站或共线站
      
      比如A站是1号线和2号线的换乘站，那么A站可能在1、2号线上都有编号，也可能只在一条线上有编号。
         
      - 分支线
      
      指一条线有多于两个终点，需要注意分支线的编号规则，以及分岔站的编号。
         
      公交线路如果写入记录，一般也在“线路和站点”的位置。可能是十进制，也可能十六进制。
      请多坐几趟车找找规律，并注意非数字线路，即各种汉字或字母+数字的线路。
      
   - 本地（住建部）标准卡
   
      本地卡没有1E记录，通常只能观察18记录的终端号找规律。在不少城市连区分地铁线路都很困难，遑论识别站点。
      您需要发挥想象，大胆假设，小心求证。没有什么通用的方法。我只能遥祝您的成功。

- **附：主要城市支持情况（待补充）**

   - 北京
   
      本地卡支持：北京一卡通（受iOS系统限制，目前仅安卓版可以读取）、京津冀互联互通卡
      
      轨道交通：一卡通可显示线路，互通卡可显示所有站名
      
      公交：互通卡可显示大部分线路名和上下车站序号
      
      其他消费：仅测试过一卡通在物美的消费，支持度有限
   
   - 上海
   
      本地卡支持：交通卡紫卡、交通联合首发卡
      
      轨道交通：全线全站显示
      
      公交：无法显示线路，对异地交联卡有一部分刷卡机可显示
      
      其他消费：仅能显示出租车消费，其他如停车、加油、旅游等暂不支持
   
   - 广州
   
      本地卡支持：羊城通（含交通联合版）
      
      轨道交通：羊城通可显示大部分站点名，异地交联卡可全部显示
      
      公交：无法显示线路
      
      其他消费：能显示部分便利店消费，其他场景暂不支持
      
   - 岭南通（广州以外）
   
      支持非常有限。既无法显示消费所在城市，也无法判断消费类型。
   
   - 深圳
   
      本地卡支持：深圳通（不包括早期发行的FeliCa版和互通行）
      
      轨道交通：全线全站可显示，但深圳通和部分异地交联卡没有入闸信息，仅显示出闸
      
      公交：深圳通仅能显示巴士所属的几大公司（巴士集团、东部、西部），异地交联卡可显示线路名，但无法显示前缀字母
      
      其他消费：能显示部分便利店，其他场景暂不支持
